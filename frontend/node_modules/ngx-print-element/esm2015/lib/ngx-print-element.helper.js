/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * callPrint
 * \@param printWindow
 * \@param iframe
 * @type {?}
 */
export const callPrint = (/**
 * @param {?} printWindow
 * @param {?} iframe
 * @return {?}
 */
(printWindow, iframe) => {
    if (printWindow && printWindow.printPage) {
        printWindow.printPage();
        if (iframe) {
            document.body.removeChild(iframe);
        }
    }
    else {
        setTimeout((/**
         * @return {?}
         */
        () => {
            callPrint(printWindow, iframe);
        }), 50);
    }
});
/**
 * getBaseHref
 * \@return
 * @type {?}
 */
export const getBaseHref = (/**
 * @return {?}
 */
() => {
    /** @type {?} */
    const port = (window.location.port) ? `:${window.location.port}` : '';
    return `${window.location.protocol}//${window.location.hostname}${port}${window.location.pathname}`;
});
/**
 * getMarkup
 * \@param elementHtml
 * \@param options
 * \@return
 * @type {?}
 */
export const getMarkup = (/**
 * @param {?} elementHtml
 * @param {?} options
 * @return {?}
 */
(elementHtml, options) => {
    /** @type {?} */
    const template = options.templateString;
    /** @type {?} */
    const templateRegex = new RegExp(/{{\s*printBody\s*}}/gi);
    /** @type {?} */
    let stylesheets;
    /** @type {?} */
    let styles;
    /** @type {?} */
    const html = [];
    if (template && templateRegex.test(template)) {
        elementHtml = template.replace(templateRegex, elementHtml);
    }
    html.push(`<html><head><title>${options.pageTitle || ''}</title>`);
    // If stylesheet URL's or list of stylesheet URL's are specified, override page stylesheets
    if (options.stylesheets) {
        stylesheets = Array.isArray(options.stylesheets) ? options.stylesheets : [options.stylesheets];
    }
    else {
        stylesheets = Array.prototype.slice
            .call(document.getElementsByTagName('link'))
            .map((/**
         * @param {?} link
         * @return {?}
         */
        link => link));
    }
    stylesheets.forEach((/**
     * @param {?} f
     * @return {?}
     */
    (f) => {
        html.push(`<link rel="${f.rel}" href="${f.href}">`);
    }));
    // If inline styles or list of inline styles are specified, override inline styles
    if (options.styles) {
        styles = Array.isArray(options.styles) ? [...options.styles, `.print-none { display: none; }`] : [options.styles + `.print-none { display: none; }`];
    }
    else {
        styles = Array.prototype.slice
            .call(document.getElementsByTagName('style'))
            .map((/**
         * @param {?} style
         * @return {?}
         */
        style => style.innerHTML));
    }
    styles.forEach((/**
     * @param {?} style
     * @return {?}
     */
    (style) => {
        html.push(`<style type="text/css">${style}</style>`);
    }));
    html.push(`<base href="${getBaseHref()}"/>`);
    html.push('</head><body class="pe-body">');
    html.push(elementHtml);
    html.push(`
    <script type="text/javascript">
      function printPage() {
        focus();
        print();
        ${options.printMode.toLowerCase() === 'popup' ? 'close();' : ''}
      }
    </script>
  `);
    html.push('</body></html>');
    return html.join('');
});
/**
 * printHtml
 * \@param element
 * \@param selfOptions
 * @type {?}
 */
export const printHtml = (/**
 * @param {?} element
 * @param {?=} selfOptions
 * @return {?}
 */
(element, selfOptions = {}) => {
    /** @type {?} */
    const defaultOptions = {
        htmlType: 'domObj',
        printMode: 'template',
        pageTitle: '',
        templateString: '',
        popupProperties: '',
        stylesheets: null,
        styles: null
    };
    /** @type {?} */
    const options = Object.assign({}, defaultOptions, selfOptions);
    /** @type {?} */
    let html = element;
    if (options.htmlType === 'domObj') {
        html = element.outerHTML;
    }
    // Get markup to be printed
    /** @type {?} */
    const markup = getMarkup(html, options);
    /** @type {?} */
    let printWindow;
    /** @type {?} */
    let printIframe;
    /** @type {?} */
    let printDocument;
    /** @type {?} */
    let printElementID;
    if (options.printMode.toLowerCase() === 'popup') {
        printWindow = window.open('about:blank', 'printElementWindow', options.popupProperties);
        printDocument = printWindow && printWindow.document;
    }
    else {
        printElementID = `printElement_${(Math.round(Math.random() * 99999)).toString()}`;
        printIframe = document.createElement('iframe');
        printIframe.setAttribute('id', printElementID);
        printIframe.setAttribute('src', 'about:blank');
        printIframe.setAttribute('frameBorder', '0');
        printIframe.setAttribute('scrolling', 'no');
        printIframe.setAttribute('style', 'position:fixed;bottom:100%;right:100%;');
        document.body.appendChild(printIframe);
        printDocument = (printIframe.contentWindow || printIframe.contentDocument);
        if (printDocument.document) {
            printDocument = printDocument.document;
        }
        printIframe = ((/** @type {?} */ (document))).frames ? ((/** @type {?} */ (document))).frames[printElementID] : document.getElementById(printElementID);
        printWindow = printIframe.contentWindow || printIframe;
    }
    focus();
    printDocument.open();
    // SetTimeout fixesiframe printMode does not work in firefox
    setTimeout((/**
     * @return {?}
     */
    () => {
        printDocument.write(markup);
        printDocument.close();
    }));
    callPrint(printWindow, printIframe);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXByaW50LWVsZW1lbnQuaGVscGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXByaW50LWVsZW1lbnQvIiwic291cmNlcyI6WyJsaWIvbmd4LXByaW50LWVsZW1lbnQuaGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFLQSxNQUFNLE9BQU8sU0FBUzs7Ozs7QUFBRyxDQUFDLFdBQWdCLEVBQUUsTUFBVyxFQUFFLEVBQUU7SUFDekQsSUFBSSxXQUFXLElBQUksV0FBVyxDQUFDLFNBQVMsRUFBRTtRQUN4QyxXQUFXLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDeEIsSUFBSSxNQUFNLEVBQUU7WUFDVixRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNuQztLQUNGO1NBQU07UUFDTCxVQUFVOzs7UUFBQyxHQUFHLEVBQUU7WUFDZCxTQUFTLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ2pDLENBQUMsR0FBRSxFQUFFLENBQUMsQ0FBQztLQUNSO0FBQ0gsQ0FBQyxDQUFBOzs7Ozs7QUFNRCxNQUFNLE9BQU8sV0FBVzs7O0FBQUcsR0FBRyxFQUFFOztVQUN4QixJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUU7SUFDckUsT0FBTyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxLQUFLLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxHQUFHLElBQUksR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO0FBQ3RHLENBQUMsQ0FBQTs7Ozs7Ozs7QUFRRCxNQUFNLE9BQU8sU0FBUzs7Ozs7QUFBRyxDQUFDLFdBQWdCLEVBQUUsT0FBWSxFQUFFLEVBQUU7O1VBQ3BELFFBQVEsR0FBRyxPQUFPLENBQUMs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QUM7UUFDNUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsd0NBQXdDLENBQUMsQ0FBQztRQUU1RSxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUV2QyxhQUFhLEdBQUcsQ0FBQyxXQUFXLENBQUMsYUFBYSxJQUFJLFdBQVcsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUMzRSxJQUFJLGFBQWEsQ0FBQyxRQUFRLEVBQUU7WUFDMUIsYUFBYSxHQUFHLGFBQWEsQ0FBQyxRQUFRLENBQUM7U0FDeEM7UUFFRCxXQUFXLEdBQUcsQ0FBQyxtQkFBQSxRQUFRLEVBQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxtQkFBQSxRQUFRLEVBQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUM1SCxXQUFXLEdBQUcsV0FBVyxDQUFDLGFBQWEsSUFBSSxXQUFXLENBQUM7S0FDeEQ7SUFFRCxLQUFLLEVBQUUsQ0FBQztJQUNSLGFBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUVyQiw0REFBNEQ7SUFDNUQsVUFBVTs7O0lBQUMsR0FBRyxFQUFFO1FBQ2QsYUFBYSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM1QixhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDeEIsQ0FBQyxFQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsV0FBVyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBQ3RDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogY2FsbFByaW50XG4gKiBAcGFyYW0gcHJpbnRXaW5kb3cgXG4gKiBAcGFyYW0gaWZyYW1lIFxuICovXG5leHBvcnQgY29uc3QgY2FsbFByaW50ID0gKHByaW50V2luZG93OiBhbnksIGlmcmFtZTogYW55KSA9PiB7XG4gIGlmIChwcmludFdpbmRvdyAmJiBwcmludFdpbmRvdy5wcmludFBhZ2UpIHtcbiAgICBwcmludFdpbmRvdy5wcmludFBhZ2UoKTtcbiAgICBpZiAoaWZyYW1lKSB7XG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGlmcmFtZSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY2FsbFByaW50KHByaW50V2luZG93LCBpZnJhbWUpO1xuICAgIH0sIDUwKTtcbiAgfVxufTtcblxuLyoqXG4gKiBnZXRCYXNlSHJlZlxuICogQHJldHVybnMgXG4gKi9cbmV4cG9ydCBjb25zdCBnZXRCYXNlSHJlZiA9ICgpID0+IHtcbiAgY29uc3QgcG9ydCA9ICh3aW5kb3cubG9jYXRpb24ucG9ydCkgPyBgOiR7d2luZG93LmxvY2F0aW9uLnBvcnR9YCA6ICcnO1xuICByZXR1cm4gYCR7d2luZG93LmxvY2F0aW9uLnByb3RvY29sfS8vJHt3aW5kb3cubG9jYXRpb24uaG9zdG5hbWV9JHtwb3J0fSR7d2luZG93LmxvY2F0aW9uLnBhdGhuYW1lfWA7XG59O1xuXG4vKipcbiAqIGdldE1hcmt1cFxuICogQHBhcmFtIGVsZW1lbnRIdG1sIFxuICogQHBhcmFtIG9wdGlvbnMgXG4gKiBAcmV0dXJucyBcbiAqL1xuZXhwb3J0IGNvbnN0IGdldE1hcmt1cCA9IChlbGVtZW50SHRtbDogYW55LCBvcHRpb25zOiBhbnkpID0+IHtcbiAgY29uc3QgdGVtcGxhdGUgPSBvcHRpb25zLnRlbXBsYXRlU3RyaW5nO1xuICBjb25zdCB0ZW1wbGF0ZVJlZ2V4ID0gbmV3IFJlZ0V4cCgve3tcXHMqcHJpbnRCb2R5XFxzKn19L2dpKTtcbiAgbGV0IHN0eWxlc2hlZXRzO1xuICBsZXQgc3R5bGVzO1xuICBjb25zdCBodG1sID0gW107XG5cbiAgaWYgKHRlbXBsYXRlICYmIHRlbXBsYXRlUmVnZXgudGVzdCh0ZW1wbGF0ZSkpIHtcbiAgICBlbGVtZW50SHRtbCA9IHRlbXBsYXRlLnJlcGxhY2UodGVtcGxhdGVSZWdleCwgZWxlbWVudEh0bWwpO1xuICB9XG5cbiAgaHRtbC5wdXNoKGA8aHRtbD48aGVhZD48dGl0bGU+JHtvcHRpb25zLnBhZ2VUaXRsZSB8fCAnJ308L3RpdGxlPmApO1xuXG4gIC8vIElmIHN0eWxlc2hlZXQgVVJMJ3Mgb3IgbGlzdCBvZiBzdHlsZXNoZWV0IFVSTCdzIGFyZSBzcGVjaWZpZWQsIG92ZXJyaWRlIHBhZ2Ugc3R5bGVzaGVldHNcbiAgaWYgKG9wdGlvbnMuc3R5bGVzaGVldHMpIHtcbiAgICBzdHlsZXNoZWV0cyA9IEFycmF5LmlzQXJyYXkob3B0aW9ucy5zdHlsZXNoZWV0cykgPyBvcHRpb25zLnN0eWxlc2hlZXRzIDogW29wdGlvbnMuc3R5bGVzaGVldHNdO1xuICB9IGVsc2Uge1xuICAgIHN0eWxlc2hlZXRzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlXG4gICAgICAuY2FsbChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbGluaycpKVxuICAgICAgLm1hcChsaW5rID0+IGxpbmspO1xuICB9XG5cbiAgc3R5bGVzaGVldHMuZm9yRWFjaCgoZjogYW55KSA9PiB7XG4gICAgaHRtbC5wdXNoKGA8bGluayByZWw9XCIke2YucmVsfVwiIGhyZWY9XCIke2YuaHJlZn1cIj5gKTtcbiAgfSk7XG5cbiAgLy8gSWYgaW5saW5lIHN0eWxlcyBvciBsaXN0IG9mIGlubGluZSBzdHlsZXMgYXJlIHNwZWNpZmllZCwgb3ZlcnJpZGUgaW5saW5lIHN0eWxlc1xuICBpZiAob3B0aW9ucy5zdHlsZXMpIHtcbiAgICBzdHlsZXMgPSBBcnJheS5pc0FycmF5KG9wdGlvbnMuc3R5bGVzKSA/IFsuLi5vcHRpb25zLnN0eWxlcywgYC5wcmludC1ub25lIHsgZGlzcGxheTogbm9uZTsgfWBdIDogW29wdGlvbnMuc3R5bGVzICsgYC5wcmludC1ub25lIHsgZGlzcGxheTogbm9uZTsgfWBdO1xuICB9IGVsc2Uge1xuICAgIHN0eWxlcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZVxuICAgICAgLmNhbGwoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3N0eWxlJykpXG4gICAgICAubWFwKHN0eWxlID0+IHN0eWxlLmlubmVySFRNTCk7XG4gIH1cblxuICBzdHlsZXMuZm9yRWFjaCgoc3R5bGU6IGFueSkgPT4ge1xuICAgIGh0bWwucHVzaChgPHN0eWxlIHR5cGU9XCJ0ZXh0L2Nzc1wiPiR7c3R5bGV9PC9zdHlsZT5gKTtcbiAgfSk7XG5cbiAgaHRtbC5wdXNoKGA8YmFzZSBocmVmPVwiJHtnZXRCYXNlSHJlZigpfVwiLz5gKTtcbiAgaHRtbC5wdXNoKCc8L2hlYWQ+PGJvZHkgY2xhc3M9XCJwZS1ib2R5XCI+Jyk7XG4gIGh0bWwucHVzaChlbGVtZW50SHRtbCk7XG4gIGh0bWwucHVzaChgXG4gICAgPHNjcmlwdCB0eXBlPVwidGV4dC9qYXZhc2NyaXB0XCI+XG4gICAgICBmdW5jdGlvbiBwcmludFBhZ2UoKSB7XG4gICAgICAgIGZvY3VzKCk7XG4gICAgICAgIHByaW50KCk7XG4gICAgICAgICR7b3B0aW9ucy5wcmludE1vZGUudG9Mb3dlckNhc2UoKSA9PT0gJ3BvcHVwJyA/ICdjbG9zZSgpOycgOiAnJ31cbiAgICAgIH1cbiAgICA8L3NjcmlwdD5cbiAgYCk7XG4gIGh0bWwucHVzaCgnPC9ib2R5PjwvaHRtbD4nKTtcblxuICByZXR1cm4gaHRtbC5qb2luKCcnKTtcbn07XG5cbi8qKlxuICogcHJpbnRIdG1sXG4gKiBAcGFyYW0gZWxlbWVudCBcbiAqIEBwYXJhbSBzZWxmT3B0aW9ucyBcbiAqL1xuZXhwb3J0IGNvbnN0IHByaW50SHRtbCA9IChlbGVtZW50OiBhbnksIHNlbGZPcHRpb25zID0ge30pID0+IHtcbiAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgaHRtbFR5cGU6ICdkb21PYmonLFxuICAgIHByaW50TW9kZTogJ3RlbXBsYXRlJyxcbiAgICBwYWdlVGl0bGU6ICcnLFxuICAgIHRlbXBsYXRlU3RyaW5nOiAnJyxcbiAgICBwb3B1cFByb3BlcnRpZXM6ICcnLFxuICAgIHN0eWxlc2hlZXRzOiBudWxsLFxuICAgIHN0eWxlczogbnVsbFxuICB9O1xuICBjb25zdCBvcHRpb25zID0geyAuLi5kZWZhdWx0T3B0aW9ucywgLi4uc2VsZk9wdGlvbnMgfTtcbiAgbGV0IGh0bWwgPSBlbGVtZW50O1xuICBpZiAob3B0aW9ucy5odG1sVHlwZSA9PT0gJ2RvbU9iaicpIHtcbiAgICBodG1sID0gZWxlbWVudC5vdXRlckhUTUw7XG4gIH1cblxuICAvLyBHZXQgbWFya3VwIHRvIGJlIHByaW50ZWRcbiAgY29uc3QgbWFya3VwID0gZ2V0TWFya3VwKGh0bWwsIG9wdGlvbnMpO1xuICBsZXQgcHJpbnRXaW5kb3c7XG4gIGxldCBwcmludElmcmFtZTtcbiAgbGV0IHByaW50RG9jdW1lbnQ6IGFueTtcbiAgbGV0IHByaW50RWxlbWVudElEO1xuXG4gIGlmIChvcHRpb25zLnByaW50TW9kZS50b0xvd2VyQ2FzZSgpID09PSAncG9wdXAnKSB7XG4gICAgcHJpbnRXaW5kb3cgPSB3aW5kb3cub3BlbignYWJvdXQ6YmxhbmsnLCAncHJpbnRFbGVtZW50V2luZG93Jywgb3B0aW9ucy5wb3B1cFByb3BlcnRpZXMpO1xuICAgIHByaW50RG9jdW1lbnQgPSBwcmludFdpbmRvdyAmJiBwcmludFdpbmRvdy5kb2N1bWVudDtcbiAgfSBlbHNlIHtcbiAgICBwcmludEVsZW1lbnRJRCA9IGBwcmludEVsZW1lbnRfJHsoTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogOTk5OTkpKS50b1N0cmluZygpfWA7XG5cbiAgICBwcmludElmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xuICAgIHByaW50SWZyYW1lLnNldEF0dHJpYnV0ZSgnaWQnLCBwcmludEVsZW1lbnRJRCk7XG4gICAgcHJpbnRJZnJhbWUuc2V0QXR0cmlidXRlKCdzcmMnLCAnYWJvdXQ6YmxhbmsnKTtcbiAgICBwcmludElmcmFtZS5zZXRBdHRyaWJ1dGUoJ2ZyYW1lQm9yZGVyJywgJzAnKTtcbiAgICBwcmludElmcmFtZS5zZXRBdHRyaWJ1dGUoJ3Njcm9sbGluZycsICdubycpO1xuICAgIHByaW50SWZyYW1lLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAncG9zaXRpb246Zml4ZWQ7Ym90dG9tOjEwMCU7cmlnaHQ6MTAwJTsnKTtcblxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocHJpbnRJZnJhbWUpO1xuXG4gICAgcHJpbnREb2N1bWVudCA9IChwcmludElmcmFtZS5jb250ZW50V2luZG93IHx8IHByaW50SWZyYW1lLmNvbnRlbnREb2N1bWVudCk7XG4gICAgaWYgKHByaW50RG9jdW1lbnQuZG9jdW1lbnQpIHtcbiAgICAgIHByaW50RG9jdW1lbnQgPSBwcmludERvY3VtZW50LmRvY3VtZW50O1xuICAgIH1cblxuICAgIHByaW50SWZyYW1lID0gKGRvY3VtZW50IGFzIGFueSkuZnJhbWVzID8gKGRvY3VtZW50IGFzIGFueSkuZnJhbWVzW3ByaW50RWxlbWVudElEXSA6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHByaW50RWxlbWVudElEKTtcbiAgICBwcmludFdpbmRvdyA9IHByaW50SWZyYW1lLmNvbnRlbnRXaW5kb3cgfHwgcHJpbnRJZnJhbWU7XG4gIH1cblxuICBmb2N1cygpO1xuICBwcmludERvY3VtZW50Lm9wZW4oKTtcblxuICAvLyBTZXRUaW1lb3V0IGZpeGVzaWZyYW1lIHByaW50TW9kZSBkb2VzIG5vdCB3b3JrIGluIGZpcmVmb3hcbiAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgcHJpbnREb2N1bWVudC53cml0ZShtYXJrdXApO1xuICAgIHByaW50RG9jdW1lbnQuY2xvc2UoKTtcbiAgfSk7XG5cbiAgY2FsbFByaW50KHByaW50V2luZG93LCBwcmludElmcmFtZSk7XG59O1xuIl19