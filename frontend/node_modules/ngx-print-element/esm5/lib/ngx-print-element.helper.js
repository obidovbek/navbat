/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/**
 * callPrint
 * \@param printWindow
 * \@param iframe
 * @type {?}
 */
export var callPrint = (/**
 * @param {?} printWindow
 * @param {?} iframe
 * @return {?}
 */
function (printWindow, iframe) {
    if (printWindow && printWindow.printPage) {
        printWindow.printPage();
        if (iframe) {
            document.body.removeChild(iframe);
        }
    }
    else {
        setTimeout((/**
         * @return {?}
         */
        function () {
            callPrint(printWindow, iframe);
        }), 50);
    }
});
/**
 * getBaseHref
 * \@return
 * @type {?}
 */
export var getBaseHref = (/**
 * @return {?}
 */
function () {
    /** @type {?} */
    var port = (window.location.port) ? ":" + window.location.port : '';
    return window.location.protocol + "//" + window.location.hostname + port + window.location.pathname;
});
/**
 * getMarkup
 * \@param elementHtml
 * \@param options
 * \@return
 * @type {?}
 */
export var getMarkup = (/**
 * @param {?} elementHtml
 * @param {?} options
 * @return {?}
 */
function (elementHtml, options) {
    /** @type {?} */
    var template = options.templateString;
    /** @type {?} */
    var templateRegex = new RegExp(/{{\s*printBody\s*}}/gi);
    /** @type {?} */
    var stylesheets;
    /** @type {?} */
    var styles;
    /** @type {?} */
    var html = [];
    if (template && templateRegex.test(template)) {
        elementHtml = template.replace(templateRegex, elementHtml);
    }
    html.push("<html><head><title>" + (options.pageTitle || '') + "</title>");
    // If stylesheet URL's or list of stylesheet URL's are specified, override page stylesheets
    if (options.stylesheets) {
        stylesheets = Array.isArray(options.stylesheets) ? options.stylesheets : [options.stylesheets];
    }
    else {
        stylesheets = Array.prototype.slice
            .call(document.getElementsByTagName('link'))
            .map((/**
         * @param {?} link
         * @return {?}
         */
        function (link) { return link; }));
    }
    stylesheets.forEach((/**
     * @param {?} f
     * @return {?}
     */
    function (f) {
        html.push("<link rel=\"" + f.rel + "\" href=\"" + f.href + "\">");
    }));
    // If inline styles or list of inline styles are specified, override inline styles
    if (options.styles) {
        styles = Array.isArray(options.styles) ? tslib_1.__spread(options.styles, [".print-none { display: none; }"]) : [options.styles + ".print-none { display: none; }"];
    }
    else {
        styles = Array.prototype.slice
            .call(document.getElementsByTagName('style'))
            .map((/**
         * @param {?} style
         * @return {?}
         */
        function (style) { return style.innerHTML; }));
    }
    styles.forEach((/**
     * @param {?} style
     * @return {?}
     */
    function (style) {
        html.push("<style type=\"text/css\">" + style + "</style>");
    }));
    html.push("<base href=\"" + getBaseHref() + "\"/>");
    html.push('</head><body class="pe-body">');
    html.push(elementHtml);
    html.push("\n    <script type=\"text/javascript\">\n      function printPage() {\n        focus();\n        print();\n        " + (options.printMode.toLowerCase() === 'popup' ? 'close();' : '') + "\n      }\n    </script>\n  ");
    html.push('</body></html>');
    return html.join('');
});
/**
 * printHtml
 * \@param element
 * \@param selfOptions
 * @type {?}
 */
export var printHtml = (/**
 * @param {?} element
 * @param {?=} selfOptions
 * @return {?}
 */
function (element, selfOptions) {
    if (selfOptions === void 0) { selfOptions = {}; }
    /** @type {?} */
    var defaultOptions = {
        htmlType: 'domObj',
        printMode: 'template',
        pageTitle: '',
        templateString: '',
        popupProperties: '',
        stylesheets: null,
        styles: null
    };
    /** @type {?} */
    var options = tslib_1.__assign({}, defaultOptions, selfOptions);
    /** @type {?} */
    var html = element;
    if (options.htmlType === 'domObj') {
        html = element.outerHTML;
    }
    // Get markup to be printed
    /** @type {?} */
    var markup = getMarkup(html, options);
    /** @type {?} */
    var printWindow;
    /** @type {?} */
    var printIframe;
    /** @type {?} */
    var printDocument;
    /** @type {?} */
    var printElementID;
    if (options.printMode.toLowerCase() === 'popup') {
        printWindow = window.open('about:blank', 'printElementWindow', options.popupProperties);
        printDocument = printWindow && printWindow.document;
    }
    else {
        printElementID = "printElement_" + (Math.round(Math.random() * 99999)).toString();
        printIframe = document.createElement('iframe');
        printIframe.setAttribute('id', printElementID);
        printIframe.setAttribute('src', 'about:blank');
        printIframe.setAttribute('frameBorder', '0');
        printIframe.setAttribute('scrolling', 'no');
        printIframe.setAttribute('style', 'position:fixed;bottom:100%;right:100%;');
        document.body.appendChild(printIframe);
        printDocument = (printIframe.contentWindow || printIframe.contentDocument);
        if (printDocument.document) {
            printDocument = printDocument.document;
        }
        printIframe = ((/** @type {?} */ (document))).frames ? ((/** @type {?} */ (document))).frames[printElementID] : document.getElementById(printElementID);
        printWindow = printIframe.contentWindow || printIframe;
    }
    focus();
    printDocument.open();
    // SetTimeout fixesiframe printMode does not work in firefox
    setTimeout((/**
     * @return {?}
     */
    function () {
        printDocument.write(markup);
        printDocument.close();
    }));
    callPrint(printWindow, printIframe);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXByaW50LWVsZW1lbnQuaGVscGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXByaW50LWVsZW1lbnQvIiwic291cmNlcyI6WyJsaWIvbmd4LXByaW50LWVsZW1lbnQuaGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBS0EsTUFBTSxLQUFPLFNBQVM7Ozs7O0FBQUcsVUFBQyxXQUFnQixFQUFFLE1BQVc7SUFDckQsSUFBSSxXQUFXLElBQUksV0FBVyxDQUFDLFNBQVMsRUFBRTtRQUN4QyxXQUFXLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDeEIsSUFBSSxNQUFNLEVBQUU7WUFDVixRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNuQztLQUNGO1NBQU07UUFDTCxVQUFVOzs7UUFBQztZQUNULFNBQVMsQ0FBQyxXQUFXLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDakMsQ0FBQyxHQUFFLEVBQUUsQ0FBQyxDQUFDO0tBQ1I7QUFDSCxDQUFDLENBQUE7Ozs7OztBQU1ELE1BQU0sS0FBTyxXQUFXOzs7QUFBRzs7UUFDbkIsSUFBSSxHQUFHLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQU0sQ0FBQyxDQUFDLENBQUMsRUFBRTtJQUNyRSxPQUFVLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxVQUFLLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxHQUFHLElBQUksR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVUsQ0FBQztBQUN0RyxDQUFDLENBQUE7Ozs7Ozs7O0FBUUQsTUFBTSxLQUFPLFNBQVM7Ozs7O0FBQUcsVUFBQyxXQUFnQixFQUFFLE9BQVk7O1FBQ2hELFFBQVEsR0FBRyxPQUFPLENBQUMsY0FBYzs7UUFDakMsYUFBYSxHQUFHLElBQUksTUFBTSxDQUFDLHVCQUF1QixDQUFDOztRQUNyRCxXQUFXOztRQUNYLE1BQU07O1FBQ0osSUFBSSxHQUFHLEVBQUU7SUFFZixJQUFJLFFBQVEsSUFBSSxhQUFhLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1FBQzVDLFdBQVcsR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxXQUFXLENBQUMsQ0FBQztLQUM1RDtJQUVELElBQUksQ0FBQyxJQUFJLENBQUMseUJBQXNCLE9BQU8sQ0FBQyxTQUFTLElBQUksRUFBRSxjQUFVLENBQUMsQ0FBQztJQUVuRSwyRkFBMkY7SUFDM0YsSUFBSSxPQUFPLENBQUMsV0FBVyxFQUFFO1FBQ3ZCLFdBQVcsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7S0FDaEc7U0FBTTtRQUNMLFdBQVcsR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUs7YUFDaEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQzthQUMzQyxHQUFHOzs7O1FBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLEVBQUosQ0FBSSxFQUFDLENBQUM7S0FDdEI7SUFFRCxXQUFXLENBQUMsT0FBTzs7OztJQUFDLFVBQUMsQ0FBTTtRQUN6QixJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFjLENBQUMsQ0FBQyxHQUFHLGtCQUFXLENBQUMsQ0FBQyxJQUFJLFFBQUksQ0FBQyxDQUFDO0lBQ3RELENBQUMsRUFBQyxDQUFDO0lBRUgsa0ZBQWtGO0lBQ2xGLElBQUksT0FBTyxDQUFDLE1BQU0sRUFBRTtRQUNsQixNQUFNLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxrQkFBSyxPQUFPLENBQUMsTUFBTSxHQUFFLGdDQUFnQyxHQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsZ0NBQWdDLENBQUMsQ0FBQztLQUN0SjtTQUFNO1FBQ0wsTUFBTSxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSzthQUMzQixJQUFJLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQzVDLEdBQUc7Ozs7UUFBQyxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUssQ0FBQyxTQUFTLEVBQWYsQ0FBZSxFQUFDLENBQUM7S0FDbEM7SUFFRCxNQUFNLENBQUMsT0FBTzs7OztJQUFDLFVBQUMsS0FBVTtRQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLDhCQUEwQixLQUFLLGFBQVUsQ0FBQyxDQUFDO0lBQ3ZELENBQUMsRUFBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBZSxXQUFXLEVBQUUsU0FBSyxDQUFDLENBQUM7SUFDN0MsSUFBSSxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO0lBQzNDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyx5SEFLRixPQUFPLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRSxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFLGtDQUdwRSxDQUFDLENBQUM7SUFDSCxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFFNUIsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZCLENBQUMsQ0FBQTs7Ozs7OztBQU9ELE1BQU0sS0FBTyxTQUFTOzs7OztBQUFHLFVBQUMsT0FBWSxFQUFFLFdBQWdCO0lBQWhCLDRCQUFBLEVBQUEsZ0JBQWdCOztRQUNoRCxjQUFjLEdBQUc7UUFDckIsUUFBUSxFQUFFLFFBQVE7UUFDbEIsU0FBUyxFQUFFLFVBQVU7UUFDckIsU0FBUyxFQUFFLEVBQUU7UUFDYixjQUFjLEVBQUUsRUFBRTtRQUNsQixlQUFlLEVBQUUsRUFBRTtRQUNuQixXQUFXLEVBQUUsSUFBSTtRQUNqQixNQUFNLEVBQUUsSUFBSTtLQUNiOztRQUNLLE9BQU8sd0JBQVEsY0FBYyxFQUFLLFdBQVcsQ0FBRTs7UUFDakQsSUFBSSxHQUFHLE9BQU87SUFDbEIsSUFBSSxPQUFPLENBQUMsUUFBUSxLQUFLLFFBQVEsRUFBRTtRQUNqQyxJQUFJLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQztLQUMxQjs7O1FBR0ssTUFBTSxHQUFHLFNBQVMsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDOztRQUNuQyxXQUFXOztRQUNYLFdBQVc7O1FBQ1gsYUFBa0I7O1FBQ2xCLGNBQWM7SUFFbEIsSUFBSSxPQUFPLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRSxLQUFLLE9BQU8sRUFBRTtRQUMvQyxXQUFXLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsb0JBQW9CLEVBQUUsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ3hGLGFBQWEsR0FBRyxXQUFXLElBQUksV0FBVyxDQUFDLFFBQVEsQ0FBQztLQUNyRDtTQUFNO1FBQ0wsY0FBYyxHQUFHLGtCQUFnQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFJLENBQUM7UUFFbEYsV0FBVyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDL0MsV0FBVyxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsY0FBYyxDQUFDLENBQUM7UUFDL0MsV0FBVyxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDL0MsV0FBVyxDQUFDLFlBQVksQ0FBQyxhQUFhLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDN0MsV0FBVyxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDNUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsd0NBQXdDLENBQUMsQ0FBQztRQUU1RSxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUV2QyxhQUFhLEdBQUcsQ0FBQyxXQUFXLENBQUMsYUFBYSxJQUFJLFdBQVcsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUMzRSxJQUFJLGFBQWEsQ0FBQyxRQUFRLEVBQUU7WUFDMUIsYUFBYSxHQUFHLGFBQWEsQ0FBQyxRQUFRLENBQUM7U0FDeEM7UUFFRCxXQUFXLEdBQUcsQ0FBQyxtQkFBQSxRQUFRLEVBQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxtQkFBQSxRQUFRLEVBQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUM1SCxXQUFXLEdBQUcsV0FBVyxDQUFDLGFBQWEsSUFBSSxXQUFXLENBQUM7S0FDeEQ7SUFFRCxLQUFLLEVBQUUsQ0FBQztJQUNSLGFBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUVyQiw0REFBNEQ7SUFDNUQsVUFBVTs7O0lBQUM7UUFDVCxhQUFhLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzVCLGFBQWEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUN4QixDQUFDLEVBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFDdEMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBjYWxsUHJpbnRcbiAqIEBwYXJhbSBwcmludFdpbmRvdyBcbiAqIEBwYXJhbSBpZnJhbWUgXG4gKi9cbmV4cG9ydCBjb25zdCBjYWxsUHJpbnQgPSAocHJpbnRXaW5kb3c6IGFueSwgaWZyYW1lOiBhbnkpID0+IHtcbiAgaWYgKHByaW50V2luZG93ICYmIHByaW50V2luZG93LnByaW50UGFnZSkge1xuICAgIHByaW50V2luZG93LnByaW50UGFnZSgpO1xuICAgIGlmIChpZnJhbWUpIHtcbiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoaWZyYW1lKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjYWxsUHJpbnQocHJpbnRXaW5kb3csIGlmcmFtZSk7XG4gICAgfSwgNTApO1xuICB9XG59O1xuXG4vKipcbiAqIGdldEJhc2VIcmVmXG4gKiBAcmV0dXJucyBcbiAqL1xuZXhwb3J0IGNvbnN0IGdldEJhc2VIcmVmID0gKCkgPT4ge1xuICBjb25zdCBwb3J0ID0gKHdpbmRvdy5sb2NhdGlvbi5wb3J0KSA/IGA6JHt3aW5kb3cubG9jYXRpb24ucG9ydH1gIDogJyc7XG4gIHJldHVybiBgJHt3aW5kb3cubG9jYXRpb24ucHJvdG9jb2x9Ly8ke3dpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZX0ke3BvcnR9JHt3aW5kb3cubG9jYXRpb24ucGF0aG5hbWV9YDtcbn07XG5cbi8qKlxuICogZ2V0TWFya3VwXG4gKiBAcGFyYW0gZWxlbWVudEh0bWwgXG4gKiBAcGFyYW0gb3B0aW9ucyBcbiAqIEByZXR1cm5zIFxuICovXG5leHBvcnQgY29uc3QgZ2V0TWFya3VwID0gKGVsZW1lbnRIdG1sOiBhbnksIG9wdGlvbnM6IGFueSkgPT4ge1xuICBjb25zdCB0ZW1wbGF0ZSA9IG9wdGlvbnMudGVtcGxhdGVTdHJpbmc7XG4gIGNvbnN0IHRlbXBsYXRlUmVnZXggPSBuZXcgUmVnRXhwKC97e1xccypwcmludEJvZHlcXHMqfX0vZ2kpO1xuICBsZXQgc3R5bGVzaGVldHM7XG4gIGxldCBzdHlsZXM7XG4gIGNvbnN0IGh0bWwgPSBbXTtcblxuICBpZiAodGVtcGxhdGUgJiYgdGVtcGxhdGVSZWdleC50ZXN0KHRlbXBsYXRlKSkge1xuICAgIGVsZW1lbnRIdG1sID0gdGVtcGxhdGUucmVwbGFjZSh0ZW1wbGF0ZVJlZ2V4LCBlbGVtZW50SHRtbCk7XG4gIH1cblxuICBodG1sLnB1c2goYDxodG1sPjxoZWFkPjx0aXRsZT4ke29wdGlvbnMucGFnZVRpdGxlIHx8ICcnfTwvdGl0bGU+YCk7XG5cbiAgLy8gSWYgc3R5bGVzaGVldCBVUkwncyBvciBsaXN0IG9mIHN0eWxlc2hlZXQgVVJMJ3MgYXJlIHNwZWNpZmllZCwgb3ZlcnJpZGUgcGFnZSBzdHlsZXNoZWV0c1xuICBpZiAob3B0aW9ucy5zdHlsZXNoZWV0cykge1xuICAgIHN0eWxlc2hlZXRzID0gQXJyYXkuaXNBcnJheShvcHRpb25zLnN0eWxlc2hlZXRzKSA/IG9wdGlvbnMuc3R5bGVzaGVldHMgOiBbb3B0aW9ucy5zdHlsZXNoZWV0c107XG4gIH0gZWxzZSB7XG4gICAgc3R5bGVzaGVldHMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2VcbiAgICAgIC5jYWxsKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdsaW5rJykpXG4gICAgICAubWFwKGxpbmsgPT4gbGluayk7XG4gIH1cblxuICBzdHlsZXNoZWV0cy5mb3JFYWNoKChmOiBhbnkpID0+IHtcbiAgICBodG1sLnB1c2goYDxsaW5rIHJlbD1cIiR7Zi5yZWx9XCIgaHJlZj1cIiR7Zi5ocmVmfVwiPmApO1xuICB9KTtcblxuICAvLyBJZiBpbmxpbmUgc3R5bGVzIG9yIGxpc3Qgb2YgaW5saW5lIHN0eWxlcyBhcmUgc3BlY2lmaWVkLCBvdmVycmlkZSBpbmxpbmUgc3R5bGVzXG4gIGlmIChvcHRpb25zLnN0eWxlcykge1xuICAgIHN0eWxlcyA9IEFycmF5LmlzQXJyYXkob3B0aW9ucy5zdHlsZXMpID8gWy4uLm9wdGlvbnMuc3R5bGVzLCBgLnByaW50LW5vbmUgeyBkaXNwbGF5OiBub25lOyB9YF0gOiBbb3B0aW9ucy5zdHlsZXMgKyBgLnByaW50LW5vbmUgeyBkaXNwbGF5OiBub25lOyB9YF07XG4gIH0gZWxzZSB7XG4gICAgc3R5bGVzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlXG4gICAgICAuY2FsbChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3R5bGUnKSlcbiAgICAgIC5tYXAoc3R5bGUgPT4gc3R5bGUuaW5uZXJIVE1MKTtcbiAgfVxuXG4gIHN0eWxlcy5mb3JFYWNoKChzdHlsZTogYW55KSA9PiB7XG4gICAgaHRtbC5wdXNoKGA8c3R5bGUgdHlwZT1cInRleHQvY3NzXCI+JHtzdHlsZX08L3N0eWxlPmApO1xuICB9KTtcblxuICBodG1sLnB1c2goYDxiYXNlIGhyZWY9XCIke2dldEJhc2VIcmVmKCl9XCIvPmApO1xuICBodG1sLnB1c2goJzwvaGVhZD48Ym9keSBjbGFzcz1cInBlLWJvZHlcIj4nKTtcbiAgaHRtbC5wdXNoKGVsZW1lbnRIdG1sKTtcbiAgaHRtbC5wdXNoKGBcbiAgICA8c2NyaXB0IHR5cGU9XCJ0ZXh0L2phdmFzY3JpcHRcIj5cbiAgICAgIGZ1bmN0aW9uIHByaW50UGFnZSgpIHtcbiAgICAgICAgZm9jdXMoKTtcbiAgICAgICAgcHJpbnQoKTtcbiAgICAgICAgJHtvcHRpb25zLnByaW50TW9kZS50b0xvd2VyQ2FzZSgpID09PSAncG9wdXAnID8gJ2Nsb3NlKCk7JyA6ICcnfVxuICAgICAgfVxuICAgIDwvc2NyaXB0PlxuICBgKTtcbiAgaHRtbC5wdXNoKCc8L2JvZHk+PC9odG1sPicpO1xuXG4gIHJldHVybiBodG1sLmpvaW4oJycpO1xufTtcblxuLyoqXG4gKiBwcmludEh0bWxcbiAqIEBwYXJhbSBlbGVtZW50IFxuICogQHBhcmFtIHNlbGZPcHRpb25zIFxuICovXG5leHBvcnQgY29uc3QgcHJpbnRIdG1sID0gKGVsZW1lbnQ6IGFueSwgc2VsZk9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICBodG1sVHlwZTogJ2RvbU9iaicsXG4gICAgcHJpbnRNb2RlOiAndGVtcGxhdGUnLFxuICAgIHBhZ2VUaXRsZTogJycsXG4gICAgdGVtcGxhdGVTdHJpbmc6ICcnLFxuICAgIHBvcHVwUHJvcGVydGllczogJycsXG4gICAgc3R5bGVzaGVldHM6IG51bGwsXG4gICAgc3R5bGVzOiBudWxsXG4gIH07XG4gIGNvbnN0IG9wdGlvbnMgPSB7IC4uLmRlZmF1bHRPcHRpb25zLCAuLi5zZWxmT3B0aW9ucyB9O1xuICBsZXQgaHRtbCA9IGVsZW1lbnQ7XG4gIGlmIChvcHRpb25zLmh0bWxUeXBlID09PSAnZG9tT2JqJykge1xuICAgIGh0bWwgPSBlbGVtZW50Lm91dGVySFRNTDtcbiAgfVxuXG4gIC8vIEdldCBtYXJrdXAgdG8gYmUgcHJpbnRlZFxuICBjb25zdCBtYXJrdXAgPSBnZXRNYXJrdXAoaHRtbCwgb3B0aW9ucyk7XG4gIGxldCBwcmludFdpbmRvdztcbiAgbGV0IHByaW50SWZyYW1lO1xuICBsZXQgcHJpbnREb2N1bWVudDogYW55O1xuICBsZXQgcHJpbnRFbGVtZW50SUQ7XG5cbiAgaWYgKG9wdGlvbnMucHJpbnRNb2RlLnRvTG93ZXJDYXNlKCkgPT09ICdwb3B1cCcpIHtcbiAgICBwcmludFdpbmRvdyA9IHdpbmRvdy5vcGVuKCdhYm91dDpibGFuaycsICdwcmludEVsZW1lbnRXaW5kb3cnLCBvcHRpb25zLnBvcHVwUHJvcGVydGllcyk7XG4gICAgcHJpbnREb2N1bWVudCA9IHByaW50V2luZG93ICYmIHByaW50V2luZG93LmRvY3VtZW50O1xuICB9IGVsc2Uge1xuICAgIHByaW50RWxlbWVudElEID0gYHByaW50RWxlbWVudF8keyhNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiA5OTk5OSkpLnRvU3RyaW5nKCl9YDtcblxuICAgIHByaW50SWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgcHJpbnRJZnJhbWUuc2V0QXR0cmlidXRlKCdpZCcsIHByaW50RWxlbWVudElEKTtcbiAgICBwcmludElmcmFtZS5zZXRBdHRyaWJ1dGUoJ3NyYycsICdhYm91dDpibGFuaycpO1xuICAgIHByaW50SWZyYW1lLnNldEF0dHJpYnV0ZSgnZnJhbWVCb3JkZXInLCAnMCcpO1xuICAgIHByaW50SWZyYW1lLnNldEF0dHJpYnV0ZSgnc2Nyb2xsaW5nJywgJ25vJyk7XG4gICAgcHJpbnRJZnJhbWUuc2V0QXR0cmlidXRlKCdzdHlsZScsICdwb3NpdGlvbjpmaXhlZDtib3R0b206MTAwJTtyaWdodDoxMDAlOycpO1xuXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChwcmludElmcmFtZSk7XG5cbiAgICBwcmludERvY3VtZW50ID0gKHByaW50SWZyYW1lLmNvbnRlbnRXaW5kb3cgfHwgcHJpbnRJZnJhbWUuY29udGVudERvY3VtZW50KTtcbiAgICBpZiAocHJpbnREb2N1bWVudC5kb2N1bWVudCkge1xuICAgICAgcHJpbnREb2N1bWVudCA9IHByaW50RG9jdW1lbnQuZG9jdW1lbnQ7XG4gICAgfVxuXG4gICAgcHJpbnRJZnJhbWUgPSAoZG9jdW1lbnQgYXMgYW55KS5mcmFtZXMgPyAoZG9jdW1lbnQgYXMgYW55KS5mcmFtZXNbcHJpbnRFbGVtZW50SURdIDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocHJpbnRFbGVtZW50SUQpO1xuICAgIHByaW50V2luZG93ID0gcHJpbnRJZnJhbWUuY29udGVudFdpbmRvdyB8fCBwcmludElmcmFtZTtcbiAgfVxuXG4gIGZvY3VzKCk7XG4gIHByaW50RG9jdW1lbnQub3BlbigpO1xuXG4gIC8vIFNldFRpbWVvdXQgZml4ZXNpZnJhbWUgcHJpbnRNb2RlIGRvZXMgbm90IHdvcmsgaW4gZmlyZWZveFxuICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICBwcmludERvY3VtZW50LndyaXRlKG1hcmt1cCk7XG4gICAgcHJpbnREb2N1bWVudC5jbG9zZSgpO1xuICB9KTtcblxuICBjYWxsUHJpbnQocHJpbnRXaW5kb3csIHByaW50SWZyYW1lKTtcbn07XG4iXX0=